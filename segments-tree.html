<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Дерево отрезков — Конспект</title>
<link rel="stylesheet" href="styles/theory.css">
<link rel="stylesheet" href="styles/code.css">
</head>
<body>
<div class="container">
<h1>Дерево отрезков — Полный конспект</h1>

<h2>Введение</h2>
<p>Дерево отрезков — структура данных для работы с диапазонными запросами...</p>

<h2>Полный код</h2>
<pre><code class="cpp">
#include &lt;bits/stdc++.h&gt;
using namespace std;
#define int long long
const int inf = 1e10;
struct Node{
    int x, push, sz;
    Node(int a=0,int b=0,int c=0):x(a),push(b),sz(c){}
    Node operator+(Node a){ return Node(x+a.x,0,sz+a.sz); }
};
Node NullN(0,0,0);
struct Tree{
    vector<Node> a,t;
    Tree(vector<Node> x){
        a=x; t.assign(4*x.size(),Node());
    }
    void build(int v,int l,int r){
        if(l+1==r){ t[v]=a[l]; t[v].sz=1; return; }
        int m=(l+r)/2;
        build(2*v+1,l,m);
        build(2*v+2,m,r);
        t[v]=t[2*v+1]+t[2*v+2];
    }
    void push(int v){
        t[2*v+1].push+=t[v].push;
        t[2*v+1].x+=t[v].push*t[2*v+1].sz;
        t[2*v+2].push+=t[v].push;
        t[2*v+2].x+=t[v].push*t[2*v+2].sz;
        t[v].push=0;
    }
    Node get(int v,int l,int r,int L,int R){
        if(l>=L && r<=R) return t[v];
        if(r<=L || l>=R) return NullN;
        push(v);
        int m=(l+r)/2;
        return get(2*v+1,l,m,L,R)+get(2*v+2,m,r,L,R);
    }
    void upd_pos(int v,int l,int r,int pos,int val){
        if(l+1==r){ t[v].x=val; return; }
        push(v);
        int m=(l+r)/2;
        if(pos<m) upd_pos(2*v+1,l,m,pos,val);
        else upd_pos(2*v+2,m,r,pos,val);
        t[v]=t[2*v+1]+t[2*v+2];
    }
    void add_seg(int v,int l,int r,int L,int R,int val){
        if(l>=L && r<=R){
            t[v].x+=val*t[v].sz;
            t[v].push+=val;
            return;
        }
        if(r<=L || l>=R) return;
        push(v);
        int m=(l+r)/2;
        add_seg(2*v+1,l,m,L,R,val);
        add_seg(2*v+2,m,r,L,R,val);
        t[v]=t[2*v+1]+t[2*v+2];
    }
};
</code></pre>

<h2>Подробный конспект</h2>
<p>... (5 страниц теории: принципы работы, push, lazy, визуализации, примеры, доказательства) ...</p>

</div>
</body>
</html>
